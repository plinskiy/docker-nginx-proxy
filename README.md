# Nginx прокси для перенаправления запросов к внутренним nginx-серверам в Docker

Этот проект предоставляет автоматизированное решение для проксирования запросов к внутренним nginx-серверам в Docker-контейнерах. Основные функции:
- Автоматическое создание конфигураций для каждого инстанса.
- Поддержка HTTPS через автоматическое получение сертификатов Let's Encrypt.
- Возможность ручной настройки конфигураций, если это необходимо.


## Реализованные функции ##

1. **Автоматическое проксирование:**
    * Запросы автоматически перенаправляются на соответствующие контейнеры на основе доменного имени.
2. **Поддержка HTTPS:**
    * Сертификаты Let's Encrypt выпускаются и обновляются автоматически.
3. **Гибкая настройка:**
    * Конфигурации создаются автоматически, но при необходимости их можно настроить вручную.

## Использование ##
1. Создание проксируемого Nginx
Чтобы добавить новый контейнер для проксирования, укажите следующие переменные окружения в вашем ```docker-compose.yml```:    
```
services:
  my-app:
    image: my-php-app:latest
    environment:
      - VIRTUAL_HOST=${APP_SERVER_DOMAIN}
      - LETSENCRYPT_HOST=${APP_SERVER_DOMAIN}
      - LETSENCRYPT_EMAIL=admin@${APP_SERVER_DOMAIN}
    networks:
      - proxy-network
```

Параметры:
- ```VIRTUAL_HOST```: Доменное имя, по которому будет доступно ваше приложение.
- ```LETSENCRYPT_HOST```: Доменное имя, для которого будет выпущен SSL-сертификат.
- ```LETSENCRYPT_EMAIL```: Email, используемый для регистрации в Let's Encrypt.

2. Ручная настройка конфигураций
Если вам нужно настроить конфигурацию вручную, вы можете добавить файлы конфигурации в папку ```./nginx/vhost.d/```. Например, для домена ```example.com``` создайте файл ```example.com``` с необходимыми настройками.

3. Запуск
	* Создайте внешнюю сеть ```proxy-network```, если она ещё не создана:   
```docker network create proxy-network```
    * Запустите контейнеры:  
```docker-compose up -d```
    * Проверьте, что всё работает:
        - Откройте ```https://${APP_SERVER_DOMAIN}``` в браузере.
        - Проверьте логи контейнеров:  
```docker logs nginx-proxy```  

## Логи и отладка ##
- Логи Nginx:
  - Логи прокси-сервера доступны в контейнере ```nginx-proxy```:  
```docker logs nginx-proxy```
- Логи Let's Encrypt:
  - Логи для выпуска и обновления сертификатов доступны в контейнере ```letsencrypt```:  
```docker logs letsencrypt```

